{% extends 'base.html' %}

{% block title %}{{ movie.title }} · Tiketa{% endblock %}

{% block extra_head %}
<style>
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 32px;
        margin-bottom: 32px;
    }

    .poster-frame {
        position: relative;
    }

    .poster-frame::after {
        content: "";
        position: absolute;
        inset: 12px;
        border-radius: 22px;
        border: 1px solid rgba(148, 163, 184, 0.18);
        pointer-events: none;
    }

    .movie-poster-lg {
        width: 100%;
        border-radius: 24px;
        box-shadow: 0 25px 70px rgba(15, 23, 42, 0.55);
        object-fit: cover;
        aspect-ratio: 2 / 3;
    }

    .movie-headline {
        display: grid;
        gap: 18px;
    }

    .movie-title {
        font-size: clamp(2rem, 4vw, 2.8rem);
        font-weight: 600;
        margin: 0;
    }

    .movie-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        color: rgba(226, 232, 240, 0.75);
    }

    .movie-description {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: 1.05rem;
    }

    .genre-tags {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        column-gap: 10px;
        row-gap: 8px;
        align-items: center;
    }

    .showtimes-card {
        display: grid;
        gap: 18px;
    }

    .showtime-day {
        display: grid;
        gap: 14px;
    }

    .showtime-date {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        letter-spacing: 0.01em;
    }

    .showtime-day-list {
        display: grid;
        gap: 12px;
    }

    .showtime-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        padding: 16px 20px;
        border-radius: 18px;
        border: 1px solid rgba(148, 163, 184, 0.22);
        background: rgba(15, 23, 42, 0.62);
    }

    .showtime-time {
        font-weight: 600;
        font-size: 1.1rem;
        letter-spacing: 0.04em;
    }

    .showtime-meta {
        color: rgba(226, 232, 240, 0.7);
        font-size: 0.95rem;
    }

    .back-link {
        margin-bottom: 22px;
    }

    @media (max-width: 640px) {
        .showtime-item {
            flex-direction: column;
            align-items: flex-start;
        }

        .showtime-item .btn {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="back-link">
    <a href="{{ url_for('movies.index') }}" class="btn btn-ghost">← Kembali ke Halaman Awal</a>
</div>

<section class="card card-padding detail-grid">
    {% if movie.poster_path %}
        <div class="poster-frame">
            <img src="{{ movie.poster_path }}" alt="Poster of {{ movie.title }}" class="movie-poster-lg">
        </div>
    {% endif %}
    <div class="movie-headline">
        <div>
            <h2 class="movie-title">{{ movie.title }}</h2>
            <div class="movie-meta">
                <span class="badge">Studio {{ '%02d'|format(movie.studio_number) }}</span>
                {% if movie.release_date %}
                    <span>Released {{ movie.release_date.strftime('%B %d, %Y') }}</span>
                {% endif %}
                {% set daily_slots = 6 if movie.studio_number % 2 == 0 else 5 %}
                <span>{{ daily_slots }} shows daily ({{ 'Even' if movie.studio_number % 2 == 0 else 'Odd' }} studio)</span>
            </div>
        </div>
        <p class="movie-description">{{ movie.description }}</p>
        {% if movie.genres %}
            <div class="genre-tags">
                {% for genre in movie.genres %}
                    <span class="tag">{{ genre.name }}</span>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</section>

<section class="card card-padding showtimes-card">
    <div class="section-title">Available Showtimes</div>
    {% if grouped_showtimes %}
        {% for show_date, showtimes in grouped_showtimes.items() %}
            <div class="showtime-day">
                <h3 class="showtime-date">{{ show_date.strftime('%A, %d %B %Y') }}</h3>
                <div class="showtime-day-list">
                    {% for showtime in showtimes %}
                        <div class="showtime-item">
                            <div>
                                <div class="showtime-time">{{ showtime.time.strftime('%H:%M') }}</div>
                                <div class="showtime-meta">
                                    Studio {{ '%02d'|format(movie.studio_number) }} · Duration 2h · Ends {{ (showtime.time + timedelta(hours=2)).strftime('%H:%M') }}
                                </div>
                            </div>
                            <a href="{{ url_for('movies.book_ticket', showtime_id=showtime.id) }}" class="btn btn-primary">Booking sekarang</a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p style="color: var(--text-secondary);">No showtimes available for this movie.</p>
    {% endif %}
</section>
{% endblock %}